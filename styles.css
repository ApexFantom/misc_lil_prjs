/* =========================
   Токены
   ========================= */
:root{
  --panel-bg:#fff; --panel-shadow:0 4px 12px rgba(0,0,0,.15);
  --primary:#0b69ff; --muted:#eef1f6; --text:#1b2430; --hint:#667085;
  --danger:#ff4d4f; --stroke:#666; --stroke-sel:#000;
  --ok:#22c55e; --bad:#ef4444; --active:#2563eb;
}

/* =========================
   База/каркас
   ========================= */
html,body{height:100%;margin:0}
.layout{display:flex;height:100vh;overflow:hidden}
.map-col{flex:2 1 0;min-width:0;position:relative;background:#f3f5f8}
.side{flex:1 1 0;min-width:280px;max-width:520px;border-left:1px solid #e5e7eb;background:#fff;overflow:auto}

.panel{padding:14px 16px;display:grid;gap:12px;background:var(--panel-bg)}
.status{font-size:13px;color:#333}
.controls{display:grid;gap:8px;grid-template-columns:repeat(2,minmax(0,1fr))}
.controls .row-1{grid-column:1/-1}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.palette{display:flex;flex-wrap:wrap;gap:6px}
.sw{width:34px;height:28px;border-radius:6px;cursor:pointer;border:2px solid rgba(0,0,0,.08);box-shadow:inset 0 0 0 1px rgba(0,0,0,.06)}
.sw.selected{outline:3px solid rgba(0,0,0,.18);transform:translateY(-1px)}
button{padding:8px 12px;border-radius:8px;border:0;background:var(--primary);color:#fff;cursor:pointer}
button.secondary{background:var(--muted);color:var(--text)}
button.danger{background:var(--danger);color:#fff}
button:disabled{opacity:.55;cursor:not-allowed}
.hints{font-size:12px;color:#334155;background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:8px;line-height:1.5}
.kbd{display:inline-block;padding:2px 6px;border:1px solid #c7ced9;border-bottom-width:2px;border-radius:4px;background:#fff;font-size:12px}

/* Panzoom обёртки */
.pz-outer, .map-wrap{position:absolute;inset:0;overflow:hidden}
.pz-inner, .panzoom-inner{position:relative;touch-action:none}
.map-stage{position:relative}
img.map-image{position:absolute;display:block;max-width:none;user-select:none;-webkit-user-drag:none}

/* =========================
   Админ-режим (редактор)
   ========================= */
svg.overlay{position:absolute;pointer-events:auto}
.poly{pointer-events:auto;stroke:var(--stroke);stroke-width:2;opacity:.95;cursor:pointer}
.poly.selected{stroke:var(--stroke-sel);stroke-width:3;filter:drop-shadow(0 6px 8px rgba(0,0,0,.12));cursor:default}
.handle{pointer-events:auto;cursor:pointer}
.center-handle{fill:rgba(0,0,255,.4);stroke:#0040ff;stroke-width:2;cursor:move;pointer-events:auto}
.draft-line{stroke:#111;stroke-dasharray:6 4;fill:none}
.ghost-line{stroke:#0aa;stroke-dasharray:6 4;fill:none;opacity:.8}
.draft-dot,.ghost-dot{fill:#fff;stroke:#333}
.ghost-dot{stroke:#0aa;fill:#e6fffb;opacity:.95}
.overlay.drawing .poly{cursor:default}

/* Служебное */
.list{max-height:300px;overflow:auto;display:grid;gap:6px}
.area-item{border-radius:8px;background:#f6f7fb;display:flex;justify-content:space-between;align-items:center;gap:8px;padding:8px}
.area-item.selected{outline:2px solid #000}
.mini{width:24px;height:18px;border-radius:4px;border:1px solid rgba(0,0,0,.06)}
.name-input{width:140px;border:1px solid #d0d7e2;background:#fff;border-radius:6px;padding:4px 6px;font-size:13px}

.cursor-move{cursor:move!important}
.cursor-pointer{cursor:pointer!important}

/* =========================
   Пользовательский режим (раскраска)
   ========================= */
.area{
  position:absolute;left:0;top:0;
  width:var(--map-w);height:var(--map-h);
  background:var(--fill,transparent);
  -webkit-mask-image:var(--img);-webkit-mask-repeat:no-repeat;-webkit-mask-position:0 0;-webkit-mask-size:100% 100%;
          mask-image:var(--img);        mask-repeat:no-repeat;        mask-position:0 0;        mask-size:100% 100%;
  transition:filter .12s ease;
}

/* Активная (выделенная) область */
.area.active{
  filter: drop-shadow(0 0 2px var(--active)) drop-shadow(0 0 4px var(--active));
  z-index:2;
}

/* Проверка: внешнее + внутреннее свечение (коррект/ошибка) */
.area.correct,
.area.wrong { /* позиционирование уже у .area absolute; правило оставлено для наглядности */ }

.area.correct{
  filter:
    drop-shadow(0 0 6px var(--ok))
    drop-shadow(0 0 12px color-mix(in srgb, var(--ok) 65%, transparent));
}
.area.wrong{
  filter:
    drop-shadow(0 0 6px var(--bad))
    drop-shadow(0 0 12px color-mix(in srgb, var(--bad) 65%, transparent));
}

/* Внутреннее свечение — через inset box-shadow, обрезается маской области */
.area.correct::before,
.area.wrong::before{
  content:"";
  position:absolute; inset:0; pointer-events:none;
  -webkit-mask: var(--img) no-repeat 0 0 / 100% 100%;
          mask: var(--img) no-repeat 0 0 / 100% 100%;
}
.area.correct::before{
  box-shadow:
    inset 0 0 14px color-mix(in srgb, var(--ok) 70%, transparent),
    inset 0 0 28px color-mix(in srgb, var(--ok) 45%, transparent);
}
.area.wrong::before{
  box-shadow:
    inset 0 0 14px color-mix(in srgb, var(--bad) 70%, transparent),
    inset 0 0 28px color-mix(in srgb, var(--bad) 45%, transparent);
}

/* Подложка-сетка */
.backgrid{
  position:absolute;inset:0;background:
  linear-gradient(90deg, rgba(0,0,0,.03) 1px, transparent 1px) 0 0/20px 20px,
  linear-gradient(   0deg, rgba(0,0,0,.03) 1px, transparent 1px) 0 0/20px 20px;
}
